<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scientific Expression Compiler - Interactive Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- MathJax for mathematical rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>

    <!-- D3.js for AST visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Chart.js for function plotting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Mermaid.js for compiler flow diagrams -->
    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({ startOnLoad: true, theme: "dark" });
      window.mermaid = mermaid;
    </script>

    <style>
      :root {
        --bg-primary: #0a0e27;
        --bg-secondary: #141b2d;
        --bg-card: #1a2035;
        --text-primary: #e0e6ed;
        --text-secondary: #9ca3af;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --border: #2d3748;
      }

      .light-mode {
        --bg-primary: #f5f7fa;
        --bg-secondary: #ffffff;
        --bg-card: #ffffff;
        --text-primary: #1a202c;
        --text-secondary: #4a5568;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --border: #e2e8f0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: var(--bg-primary);
        min-height: 100vh;
        color: var(--text-primary);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        transition: background 0.3s ease, color 0.3s ease;
      }

      .glass-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .glass-card:hover {
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
      }

      .token-badge {
        display: inline-block;
        padding: 6px 14px;
        margin: 4px;
        border-radius: 6px;
        font-family: 'JetBrains Mono', 'Courier New', monospace;
        font-size: 13px;
        font-weight: 500;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        color: var(--text-primary);
        animation: fadeIn 0.3s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-box {
        background: var(--accent);
        color: white;
        padding: 32px;
        border-radius: 8px;
        font-size: 36px;
        font-weight: 600;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .code-block {
        background: var(--bg-secondary);
        color: var(--text-primary);
        padding: 16px;
        border-radius: 8px;
        font-family: 'JetBrains Mono', 'Courier New', monospace;
        font-size: 13px;
        overflow-x: auto;
        border-left: 3px solid var(--accent);
        line-height: 1.6;
      }

      #astCanvas {
        width: 100%;
        height: 500px;
        background: var(--bg-secondary);
        border-radius: 8px;
        border: 1px solid var(--border);
      }

      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--bg-card);
        border: 1px solid var(--border);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .theme-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      input {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border) !important;
      }

      input::placeholder {
        color: var(--text-secondary) !important;
      }

      button {
        transition: all 0.2s ease;
      }

      button:hover {
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body class="p-8">
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
      üåô
    </button>

    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-2" style="color: var(--text-primary);">
          Scientific Expression Compiler
        </h1>
        <p class="text-sm" style="color: var(--text-secondary);">
          Interactive Compiler Pipeline with Numerical Calculus & Visualization
        </p>
      </div>

      <!-- Input Section -->
      <div class="glass-card p-6 mb-6">
        <div class="flex gap-3 mb-4">
          <input
            type="text"
            id="expressionInput"
            placeholder="Enter expression (e.g., diff(x^2, x, 3))"
            class="flex-1 px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            onkeypress="if(event.key === 'Enter') compileExpression()"
          />
          <button
            onclick="compileExpression()"
            class="px-6 py-3 rounded-lg font-medium"
            style="background: var(--accent); color: white;"
          >
            Compile
          </button>
        </div>

        <!-- Example buttons -->
        <div class="flex flex-wrap gap-2">
          <button onclick="setExample('sin(pi/2)')" class="token-badge text-xs">sin(œÄ/2)</button>
          <button onclick="setExample('2^10')" class="token-badge text-xs">2^10</button>
          <button onclick="setExample('5!')" class="token-badge text-xs">5!</button>
          <button onclick="setExample('diff(x^2, x, 3)')" class="token-badge text-xs">diff(x^2, x, 3)</button>
          <button onclick="setExample('integrate(x^2, x, 0, 3)')" class="token-badge text-xs">integrate(x^2, x, 0, 3)</button>
        </div>
      </div>

      <!-- Result Section -->
      <div id="resultSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Result</h3>
          <div class="result-box">
            <div id="resultValue"></div>
          </div>
        </div>
      </div>
        </div>
      </div>

      <!-- Tokens Section -->
      <div id="tokensSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h2 class="text-2xl font-bold text-white mb-4">
            1Ô∏è‚É£ Lexical Analysis - Token Stream
          </h2>
          <div id="tokensDisplay" class="flex flex-wrap"></div>
        </div>
      </div>

      <!-- Postfix Section -->
      <div id="postfixSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h2 class="text-2xl font-bold text-white mb-4">
            2Ô∏è‚É£ Syntax Analysis - Postfix (RPN)
          </h2>
          <p class="text-white text-sm mb-3 opacity-80">
            Shunting Yard Algorithm Output
          </p>
          <d3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Result</h3>
          <div class="result-box
      </div>

      <!-- AST Section -->
      <div id="astSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <Tokens Section -->
      <div id="tokensSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Tokens</h3>
          <div id="tokensDisplay" class="flex flex-wrap"></div>
        </div>
      </div>

      <!-- Postfix Section -->
      <div id="postfixSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Postfix Notation</h3>
          <div id="postfixDisplay" class="flex flex-wrap"></div>
        </div>
      </div>

      <!-- AST Section -->
      <div id="astSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Abstract Syntax Tree</h3>
          <div id="astCanvas"></div>
        </div>
      </div>

      <!-- Intermediate Code Section -->
      <div id="intermediateSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Intermediate Code</h3>
          <div id="intermediateCode" class="code-block"></div>
        </div>
      </div>

      <!-- Calculus Visualization -->
      <div id="calculusSection" class="hidden mb-6">
        <div class="glass-card p-6">
          <h3 class="text-lg font-semibold mb-4" style="color: var(--text-primary);">Numerical Calculus</h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <h4 class="text-sm font-medium mb-3" style="color: var(--text-secondary);">Steps</h4>
              <div id="calculusSteps" class="code-block"></div>
            </div>
            <div>
              <h4 class="text-sm font-medium mb-3" style="color: var(--text-secondary);">Function Plot</h4>
              <canvas id="calculusChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Section -->
      <div id="errorSection" class="hidden mb-6">
        <div class="glass-card p-6" style="border: 2px solid #ef4444;">
          <h3 class="text-lg font-semibold mb-4" style="color: #ef4444;">Error</h3>
          <div id="errorMessage" style="color: var(--text-primary);"></div>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-12" style="color: var(--text-secondary); font-size: 12px;">
        <p>Built with C++, Python Flask, and JavaScript</p>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      // Theme toggle functionality
      function toggleTheme() {
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        
        if (body.classList.contains('light-mode')) {
          body.classList.remove('light-mode');
          themeToggle.textContent = 'üåô';
          localStorage.setItem('theme', 'dark');
        } else {
          body.classList.add('light-mode');
          themeToggle.textContent = '‚òÄÔ∏è';
          localStorage.setItem('theme', 'light');
        }
      }
      
      // Load saved theme
      window.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
          document.body.classList.add('light-mode');
          document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        }
      });
    </script>
    <script src="/js/app.js"></script>
    <script src="/js/visualizer.js"></script>
  </body>
</html>